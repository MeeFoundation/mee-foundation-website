var Xt=Object.defineProperty,er=(e,t,n)=>t in e?Xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,lt=(e,t,n)=>(er(e,typeof t!="symbol"?t+"":t,n),n),P=crypto;const Z=e=>e instanceof CryptoKey,tr=async(e,t)=>{const n=`SHA-${e.slice(-3)}`;return new Uint8Array(await P.subtle.digest(n,t))};var rr=tr;const $=new TextEncoder,ne=new TextDecoder,_e=2**32;function se(...e){const t=e.reduce((c,{length:f})=>c+f,0),n=new Uint8Array(t);let o=0;return e.forEach(c=>{n.set(c,o),o+=c.length}),n}function nr(e,t){return se($.encode(e),new Uint8Array([0]),t)}function He(e,t,n){if(t<0||t>=_e)throw new RangeError(`value must be >= 0 and <= ${_e-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,t&255],n)}function ir(e){const t=Math.floor(e/_e),n=e%_e,o=new Uint8Array(8);return He(o,t,0),He(o,n,4),o}function qe(e){const t=new Uint8Array(4);return He(t,e),t}function Ke(e){return se(qe(e.length),e)}async function or(e,t,n){const o=Math.ceil((t>>3)/32),c=new Uint8Array(o*32);for(let f=0;f<o;f++){const g=new Uint8Array(4+e.length+n.length);g.set(qe(f+1)),g.set(e,4),g.set(n,4+e.length),c.set(await rr("sha256",g),f*32)}return c.slice(0,t>>3)}const bt=e=>{let t=e;typeof t=="string"&&(t=$.encode(t));const n=32768,o=[];for(let c=0;c<t.length;c+=n)o.push(String.fromCharCode.apply(null,t.subarray(c,c+n)));return btoa(o.join(""))},Ae=e=>bt(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),ar=e=>{const t=atob(e),n=new Uint8Array(t.length);for(let o=0;o<t.length;o++)n[o]=t.charCodeAt(o);return n},z=e=>{let t=e;t instanceof Uint8Array&&(t=ne.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return ar(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class ie extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(t){var n;super(t),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(n=Error.captureStackTrace)===null||n===void 0||n.call(Error,this,this.constructor)}}class j extends ie{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(t,n="unspecified",o="unspecified"){super(t),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=n,this.reason=o}}class pt extends ie{static get code(){return"ERR_JWT_EXPIRED"}constructor(t,n="unspecified",o="unspecified"){super(t),this.code="ERR_JWT_EXPIRED",this.claim=n,this.reason=o}}class Ue extends ie{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class K extends ie{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class Re extends ie{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}}class C extends ie{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}}class R extends ie{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class X extends ie{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}class sr extends ie{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}var cr=P.getRandomValues.bind(P);function ur(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new K(`Unsupported JWE Algorithm: ${e}`)}}const lr=(e,t)=>{if(t.length<<3!==ur(e))throw new C("Invalid Initialization Vector length")};var pr=lr;const dr=(e,t)=>{const n=e.byteLength<<3;if(n!==t)throw new C(`Invalid Content Encryption Key length. Expected ${t} bits, got ${n} bits`)};var dt=dr;const fr=(e,t)=>{if(!(e instanceof Uint8Array))throw new TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw new TypeError("Second argument must be a buffer");if(e.length!==t.length)throw new TypeError("Input buffers must have the same length");const n=e.length;let o=0,c=-1;for(;++c<n;)o|=e[c]^t[c];return o===0};var hr=fr;function ve(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}function L(e,t="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function re(e,t){return e.name===t}function Se(e){return parseInt(e.name.slice(4),10)}function yr(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function _t(e,t){if(t.length&&!t.some(n=>e.usages.includes(n))){let n="CryptoKey does not support this operation, its usages must include ";if(t.length>2){const o=t.pop();n+=`one of ${t.join(", ")}, or ${o}.`}else t.length===2?n+=`one of ${t[0]} or ${t[1]}.`:n+=`${t[0]}.`;throw new TypeError(n)}}function gr(e,t,...n){switch(t){case"HS256":case"HS384":case"HS512":{if(!re(e.algorithm,"HMAC"))throw L("HMAC");const o=parseInt(t.slice(2),10);if(Se(e.algorithm.hash)!==o)throw L(`SHA-${o}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!re(e.algorithm,"RSASSA-PKCS1-v1_5"))throw L("RSASSA-PKCS1-v1_5");const o=parseInt(t.slice(2),10);if(Se(e.algorithm.hash)!==o)throw L(`SHA-${o}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!re(e.algorithm,"RSA-PSS"))throw L("RSA-PSS");const o=parseInt(t.slice(2),10);if(Se(e.algorithm.hash)!==o)throw L(`SHA-${o}`,"algorithm.hash");break}case"EdDSA":{if(e.algorithm.name!=="Ed25519"&&e.algorithm.name!=="Ed448"){if(ve()){if(re(e.algorithm,"NODE-ED25519"))break;throw L("Ed25519, Ed448, or NODE-ED25519")}throw L("Ed25519 or Ed448")}break}case"ES256":case"ES384":case"ES512":{if(!re(e.algorithm,"ECDSA"))throw L("ECDSA");const o=yr(t);if(e.algorithm.namedCurve!==o)throw L(o,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}_t(e,n)}function fe(e,t,...n){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!re(e.algorithm,"AES-GCM"))throw L("AES-GCM");const o=parseInt(t.slice(1,4),10);if(e.algorithm.length!==o)throw L(o,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!re(e.algorithm,"AES-KW"))throw L("AES-KW");const o=parseInt(t.slice(1,4),10);if(e.algorithm.length!==o)throw L(o,"algorithm.length");break}case"ECDH":{switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw L("ECDH, X25519, or X448")}break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!re(e.algorithm,"PBKDF2"))throw L("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!re(e.algorithm,"RSA-OAEP"))throw L("RSA-OAEP");const o=parseInt(t.slice(9),10)||1;if(Se(e.algorithm.hash)!==o)throw L(`SHA-${o}`,"algorithm.hash");break}default:throw new TypeError("CryptoKey does not support this operation")}_t(e,n)}function Mt(e,t,...n){if(n.length>2){const o=n.pop();e+=`one of type ${n.join(", ")}, or ${o}.`}else n.length===2?e+=`one of type ${n[0]} or ${n[1]}.`:e+=`of type ${n[0]}.`;return t==null?e+=` Received ${t}`:typeof t=="function"&&t.name?e+=` Received function ${t.name}`:typeof t=="object"&&t!=null&&t.constructor&&t.constructor.name&&(e+=` Received an instance of ${t.constructor.name}`),e}var V=(e,...t)=>Mt("Key must be ",e,...t);function Ct(e,t,...n){return Mt(`Key for the ${e} algorithm must be `,t,...n)}var Dt=e=>Z(e);const x=["CryptoKey"];async function vr(e,t,n,o,c,f){if(!(t instanceof Uint8Array))throw new TypeError(V(t,"Uint8Array"));const g=parseInt(e.slice(1,4),10),E=await P.subtle.importKey("raw",t.subarray(g>>3),"AES-CBC",!1,["decrypt"]),A=await P.subtle.importKey("raw",t.subarray(0,g>>3),{hash:`SHA-${g<<1}`,name:"HMAC"},!1,["sign"]),m=se(f,o,n,ir(f.length<<3)),u=new Uint8Array((await P.subtle.sign("HMAC",A,m)).slice(0,g>>3));let d;try{d=hr(c,u)}catch{}if(!d)throw new Re;let v;try{v=new Uint8Array(await P.subtle.decrypt({iv:o,name:"AES-CBC"},E,n))}catch{}if(!v)throw new Re;return v}async function wr(e,t,n,o,c,f){let g;t instanceof Uint8Array?g=await P.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(fe(t,e,"decrypt"),g=t);try{return new Uint8Array(await P.subtle.decrypt({additionalData:f,iv:o,name:"AES-GCM",tagLength:128},g,se(n,c)))}catch{throw new Re}}const mr=async(e,t,n,o,c,f)=>{if(!Z(t)&&!(t instanceof Uint8Array))throw new TypeError(V(t,...x,"Uint8Array"));switch(pr(e,o),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&dt(t,parseInt(e.slice(-3),10)),vr(e,t,n,o,c,f);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&dt(t,parseInt(e.slice(1,4),10)),wr(e,t,n,o,c,f);default:throw new K("Unsupported JWE Content Encryption Algorithm")}};var It=mr;const Er=async()=>{throw new K('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `inflateRaw` decrypt option to provide Inflate Raw implementation.')},Ar=(...e)=>{const t=e.filter(Boolean);if(t.length===0||t.length===1)return!0;let n;for(const o of t){const c=Object.keys(o);if(!n||n.size===0){n=new Set(c);continue}for(const f of c){if(n.has(f))return!1;n.add(f)}}return!0};var ke=Ar;function Sr(e){return typeof e=="object"&&e!==null}function ee(e){if(!Sr(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}const br=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]];var Pt=br;function _r(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw new TypeError(`Invalid key size for alg: ${t}`)}function Mr(e,t,n){if(Z(e))return fe(e,t,n),e;if(e instanceof Uint8Array)return P.subtle.importKey("raw",e,"AES-KW",!0,[n]);throw new TypeError(V(e,...x,"Uint8Array"))}const xe=async(e,t,n)=>{const o=await Mr(t,e,"unwrapKey");_r(o,e);const c=await P.subtle.unwrapKey("raw",n,o,"AES-KW",...Pt);return new Uint8Array(await P.subtle.exportKey("raw",c))};async function Cr(e,t,n,o,c=new Uint8Array(0),f=new Uint8Array(0)){if(!Z(e))throw new TypeError(V(e,...x));if(fe(e,"ECDH"),!Z(t))throw new TypeError(V(t,...x));fe(t,"ECDH","deriveBits");const g=se(Ke($.encode(n)),Ke(c),Ke(f),qe(o));let E;e.algorithm.name==="X25519"?E=256:e.algorithm.name==="X448"?E=448:E=Math.ceil(parseInt(e.algorithm.namedCurve.substr(-3),10)/8)<<3;const A=new Uint8Array(await P.subtle.deriveBits({name:e.algorithm.name,public:e},t,E));return or(A,o,g)}function Dr(e){if(!Z(e))throw new TypeError(V(e,...x));return["P-256","P-384","P-521"].includes(e.algorithm.namedCurve)||e.algorithm.name==="X25519"||e.algorithm.name==="X448"}function Ir(e){if(!(e instanceof Uint8Array)||e.length<8)throw new C("PBES2 Salt Input must be 8 or more octets")}function Pr(e,t){if(e instanceof Uint8Array)return P.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits"]);if(Z(e))return fe(e,t,"deriveBits","deriveKey"),e;throw new TypeError(V(e,...x,"Uint8Array"))}async function Nr(e,t,n,o){Ir(e);const c=nr(t,e),f=parseInt(t.slice(13,16),10),g={hash:`SHA-${t.slice(8,11)}`,iterations:n,name:"PBKDF2",salt:c},E={length:f,name:"AES-KW"},A=await Pr(o,t);if(A.usages.includes("deriveBits"))return new Uint8Array(await P.subtle.deriveBits(g,A,f));if(A.usages.includes("deriveKey"))return P.subtle.deriveKey(g,A,E,!1,["wrapKey","unwrapKey"]);throw new TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}const Tr=async(e,t,n,o,c)=>{const f=await Nr(c,e,o,t);return xe(e.slice(-6),f,n)};function ft(e){switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new K(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}var Ge=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:n}=t.algorithm;if(typeof n!="number"||n<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};const Or=async(e,t,n)=>{if(!Z(t))throw new TypeError(V(t,...x));if(fe(t,e,"decrypt","unwrapKey"),Ge(e,t),t.usages.includes("decrypt"))return new Uint8Array(await P.subtle.decrypt(ft(e),t,n));if(t.usages.includes("unwrapKey")){const o=await P.subtle.unwrapKey("raw",n,t,ft(e),...Pt);return new Uint8Array(await P.subtle.exportKey("raw",o))}throw new TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')};function Nt(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new K(`Unsupported JWE Algorithm: ${e}`)}}var Kr=e=>cr(new Uint8Array(Nt(e)>>3)),Wr=(e,t)=>{const n=(e.match(/.{1,64}/g)||[]).join(`
`);return`-----BEGIN ${t}-----
${n}
-----END ${t}-----`};const Hr=async(e,t,n)=>{if(!Z(n))throw new TypeError(V(n,...x));if(!n.extractable)throw new TypeError("CryptoKey is not extractable");if(n.type!==e)throw new TypeError(`key is not a ${e} key`);return Wr(bt(new Uint8Array(await P.subtle.exportKey(t,n))),`${e.toUpperCase()} KEY`)},Ur=e=>Hr("private","pkcs8",e),ae=(e,t,n=0)=>{n===0&&(t.unshift(t.length),t.unshift(6));let o=e.indexOf(t[0],n);if(o===-1)return!1;const c=e.subarray(o,o+t.length);return c.length!==t.length?!1:c.every((f,g)=>f===t[g])||ae(e,t,o+1)},ht=e=>{switch(!0){case ae(e,[42,134,72,206,61,3,1,7]):return"P-256";case ae(e,[43,129,4,0,34]):return"P-384";case ae(e,[43,129,4,0,35]):return"P-521";case ae(e,[43,101,110]):return"X25519";case ae(e,[43,101,111]):return"X448";case ae(e,[43,101,112]):return"Ed25519";case ae(e,[43,101,113]):return"Ed448";default:throw new K("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},Rr=async(e,t,n,o,c)=>{var f,g;let E,A;const m=new Uint8Array(atob(n.replace(e,"")).split("").map(d=>d.charCodeAt(0))),u=t==="spki";switch(o){case"PS256":case"PS384":case"PS512":E={name:"RSA-PSS",hash:`SHA-${o.slice(-3)}`},A=u?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":E={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${o.slice(-3)}`},A=u?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":E={name:"RSA-OAEP",hash:`SHA-${parseInt(o.slice(-3),10)||1}`},A=u?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":E={name:"ECDSA",namedCurve:"P-256"},A=u?["verify"]:["sign"];break;case"ES384":E={name:"ECDSA",namedCurve:"P-384"},A=u?["verify"]:["sign"];break;case"ES512":E={name:"ECDSA",namedCurve:"P-521"},A=u?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{const d=ht(m);E=d.startsWith("P-")?{name:"ECDH",namedCurve:d}:{name:d},A=u?[]:["deriveBits"];break}case"EdDSA":E={name:ht(m)},A=u?["verify"]:["sign"];break;default:throw new K('Invalid or unsupported "alg" (Algorithm) value')}try{return await P.subtle.importKey(t,m,E,(f=c?.extractable)!==null&&f!==void 0?f:!1,A)}catch(d){if(E.name==="Ed25519"&&d?.name==="NotSupportedError"&&ve())return E={name:"NODE-ED25519",namedCurve:"NODE-ED25519"},await P.subtle.importKey(t,m,E,(g=c?.extractable)!==null&&g!==void 0?g:!1,A);throw d}},xr=(e,t,n)=>Rr(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",e,t,n);function Jr(e){let t,n;switch(e.kty){case"oct":{switch(e.alg){case"HS256":case"HS384":case"HS512":t={name:"HMAC",hash:`SHA-${e.alg.slice(-3)}`},n=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new K(`${e.alg} keys cannot be imported as CryptoKey instances`);case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":t={name:"AES-GCM"},n=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":t={name:"AES-KW"},n=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":t={name:"PBKDF2"},n=["deriveBits"];break;default:throw new K('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"RSA":{switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},n=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},n=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},n=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new K('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},n=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},n=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},n=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},n=e.d?["deriveBits"]:[];break;default:throw new K('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(e.alg){case"EdDSA":t={name:e.crv},n=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},n=e.d?["deriveBits"]:[];break;default:throw new K('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new K('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:n}}const Lr=async e=>{var t,n;if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:o,keyUsages:c}=Jr(e),f=[o,(t=e.ext)!==null&&t!==void 0?t:!1,(n=e.key_ops)!==null&&n!==void 0?n:c];if(o.name==="PBKDF2")return P.subtle.importKey("raw",z(e.k),...f);const g={...e};delete g.alg,delete g.use;try{return await P.subtle.importKey("jwk",g,...f)}catch(E){if(o.name==="Ed25519"&&E?.name==="NotSupportedError"&&ve())return f[0]={name:"NODE-ED25519",namedCurve:"NODE-ED25519"},await P.subtle.importKey("jwk",g,...f);throw E}};var yt=Lr;async function zr(e,t,n){if(typeof e!="string"||e.indexOf("-----BEGIN PRIVATE KEY-----")!==0)throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return xr(e,t,n)}async function Tt(e,t,n){var o;if(!ee(e))throw new TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if(typeof e.k!="string"||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return n??(n=e.ext!==!0),n?yt({...e,alg:t,ext:(o=e.ext)!==null&&o!==void 0?o:!1}):z(e.k);case"RSA":if(e.oth!==void 0)throw new K('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return yt({...e,alg:t});default:throw new K('Unsupported "kty" (Key Type) Parameter value')}}const Br=(e,t)=>{if(!(t instanceof Uint8Array)){if(!Dt(t))throw new TypeError(Ct(e,t,...x,"Uint8Array"));if(t.type!=="secret")throw new TypeError(`${x.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},$r=(e,t,n)=>{if(!Dt(t))throw new TypeError(Ct(e,t,...x));if(t.type==="secret")throw new TypeError(`${x.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(n==="sign"&&t.type==="public")throw new TypeError(`${x.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(n==="decrypt"&&t.type==="public")throw new TypeError(`${x.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&n==="verify"&&t.type==="private")throw new TypeError(`${x.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&n==="encrypt"&&t.type==="private")throw new TypeError(`${x.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},qr=(e,t,n)=>{e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?Br(e,t):$r(e,t,n)};var Fe=qr;async function kr(e,t,n,o,c){const f=e.slice(0,7);return It(f,t,n,o,c,new Uint8Array(0))}async function Gr(e,t,n,o,c){switch(Fe(e,t,"decrypt"),e){case"dir":{if(n!==void 0)throw new C("Encountered unexpected JWE Encrypted Key");return t}case"ECDH-ES":if(n!==void 0)throw new C("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!ee(o.epk))throw new C('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!Dr(t))throw new K("ECDH with the provided key is not allowed or not supported by your javascript runtime");const f=await Tt(o.epk,e);let g,E;if(o.apu!==void 0){if(typeof o.apu!="string")throw new C('JOSE Header "apu" (Agreement PartyUInfo) invalid');g=z(o.apu)}if(o.apv!==void 0){if(typeof o.apv!="string")throw new C('JOSE Header "apv" (Agreement PartyVInfo) invalid');E=z(o.apv)}const A=await Cr(f,t,e==="ECDH-ES"?o.enc:e,e==="ECDH-ES"?Nt(o.enc):parseInt(e.slice(-5,-2),10),g,E);if(e==="ECDH-ES")return A;if(n===void 0)throw new C("JWE Encrypted Key missing");return xe(e.slice(-6),A,n)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(n===void 0)throw new C("JWE Encrypted Key missing");return Or(e,t,n)}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(n===void 0)throw new C("JWE Encrypted Key missing");if(typeof o.p2c!="number")throw new C('JOSE Header "p2c" (PBES2 Count) missing or invalid');const f=c?.maxPBES2Count||1e4;if(o.p2c>f)throw new C('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if(typeof o.p2s!="string")throw new C('JOSE Header "p2s" (PBES2 Salt) missing or invalid');return Tr(e,t,n,o.p2c,z(o.p2s))}case"A128KW":case"A192KW":case"A256KW":{if(n===void 0)throw new C("JWE Encrypted Key missing");return xe(e,t,n)}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{if(n===void 0)throw new C("JWE Encrypted Key missing");if(typeof o.iv!="string")throw new C('JOSE Header "iv" (Initialization Vector) missing or invalid');if(typeof o.tag!="string")throw new C('JOSE Header "tag" (Authentication Tag) missing or invalid');const f=z(o.iv),g=z(o.tag);return kr(e,t,n,f,g)}default:throw new K('Invalid or unsupported "alg" (JWE Algorithm) header value')}}function Qe(e,t,n,o,c){if(c.crit!==void 0&&o.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!o||o.crit===void 0)return new Set;if(!Array.isArray(o.crit)||o.crit.length===0||o.crit.some(g=>typeof g!="string"||g.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let f;n!==void 0?f=new Map([...Object.entries(n),...t.entries()]):f=t;for(const g of o.crit){if(!f.has(g))throw new K(`Extension Header Parameter "${g}" is not recognized`);if(c[g]===void 0)throw new e(`Extension Header Parameter "${g}" is missing`);if(f.get(g)&&o[g]===void 0)throw new e(`Extension Header Parameter "${g}" MUST be integrity protected`)}return new Set(o.crit)}const Fr=(e,t)=>{if(t!==void 0&&(!Array.isArray(t)||t.some(n=>typeof n!="string")))throw new TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};var Je=Fr;async function Qr(e,t,n){var o;if(!ee(e))throw new C("Flattened JWE must be an object");if(e.protected===void 0&&e.header===void 0&&e.unprotected===void 0)throw new C("JOSE Header missing");if(typeof e.iv!="string")throw new C("JWE Initialization Vector missing or incorrect type");if(typeof e.ciphertext!="string")throw new C("JWE Ciphertext missing or incorrect type");if(typeof e.tag!="string")throw new C("JWE Authentication Tag missing or incorrect type");if(e.protected!==void 0&&typeof e.protected!="string")throw new C("JWE Protected Header incorrect type");if(e.encrypted_key!==void 0&&typeof e.encrypted_key!="string")throw new C("JWE Encrypted Key incorrect type");if(e.aad!==void 0&&typeof e.aad!="string")throw new C("JWE AAD incorrect type");if(e.header!==void 0&&!ee(e.header))throw new C("JWE Shared Unprotected Header incorrect type");if(e.unprotected!==void 0&&!ee(e.unprotected))throw new C("JWE Per-Recipient Unprotected Header incorrect type");let c;if(e.protected)try{const H=z(e.protected);c=JSON.parse(ne.decode(H))}catch{throw new C("JWE Protected Header is invalid")}if(!ke(c,e.header,e.unprotected))throw new C("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");const f={...c,...e.header,...e.unprotected};if(Qe(C,new Map,n?.crit,c,f),f.zip!==void 0){if(!c||!c.zip)throw new C('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if(f.zip!=="DEF")throw new K('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}const{alg:g,enc:E}=f;if(typeof g!="string"||!g)throw new C("missing JWE Algorithm (alg) in JWE Header");if(typeof E!="string"||!E)throw new C("missing JWE Encryption Algorithm (enc) in JWE Header");const A=n&&Je("keyManagementAlgorithms",n.keyManagementAlgorithms),m=n&&Je("contentEncryptionAlgorithms",n.contentEncryptionAlgorithms);if(A&&!A.has(g))throw new Ue('"alg" (Algorithm) Header Parameter not allowed');if(m&&!m.has(E))throw new Ue('"enc" (Encryption Algorithm) Header Parameter not allowed');let u;e.encrypted_key!==void 0&&(u=z(e.encrypted_key));let d=!1;typeof t=="function"&&(t=await t(c,e),d=!0);let v;try{v=await Gr(g,t,u,f,n)}catch(H){if(H instanceof TypeError||H instanceof C||H instanceof K)throw H;v=Kr(E)}const T=z(e.iv),_=z(e.tag),I=$.encode((o=e.protected)!==null&&o!==void 0?o:"");let W;e.aad!==void 0?W=se(I,$.encode("."),$.encode(e.aad)):W=I;let U=await It(E,v,z(e.ciphertext),T,_,W);f.zip==="DEF"&&(U=await(n?.inflateRaw||Er)(U));const O={plaintext:U};return e.protected!==void 0&&(O.protectedHeader=c),e.aad!==void 0&&(O.additionalAuthenticatedData=z(e.aad)),e.unprotected!==void 0&&(O.sharedUnprotectedHeader=e.unprotected),e.header!==void 0&&(O.unprotectedHeader=e.header),d?{...O,key:t}:O}async function Vr(e,t,n){if(e instanceof Uint8Array&&(e=ne.decode(e)),typeof e!="string")throw new C("Compact JWE must be a string or Uint8Array");const{0:o,1:c,2:f,3:g,4:E,length:A}=e.split(".");if(A!==5)throw new C("Invalid Compact JWE");const m=await Qr({ciphertext:g,iv:f||void 0,protected:o||void 0,tag:E||void 0,encrypted_key:c||void 0},t,n),u={plaintext:m.plaintext,protectedHeader:m.protectedHeader};return typeof t=="function"?{...u,key:m.key}:u}const Yr=async e=>{if(e instanceof Uint8Array)return{kty:"oct",k:Ae(e)};if(!Z(e))throw new TypeError(V(e,...x,"Uint8Array"));if(!e.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:t,key_ops:n,alg:o,use:c,...f}=await P.subtle.exportKey("jwk",e);return f};var Zr=Yr;async function jr(e){return Ur(e)}async function Ve(e){return Zr(e)}function Ot(e,t){const n=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:n,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:n,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:n,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:n,name:"ECDSA",namedCurve:t.namedCurve};case"EdDSA":return ve()&&t.name==="NODE-ED25519"?{name:"NODE-ED25519",namedCurve:"NODE-ED25519"}:{name:t.name};default:throw new K(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}function Kt(e,t,n){if(Z(t))return gr(t,e,n),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(V(t,...x));return P.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[n])}throw new TypeError(V(t,...x,"Uint8Array"))}const Xr=async(e,t,n,o)=>{const c=await Kt(e,t,"verify");Ge(e,c);const f=Ot(e,c.algorithm);try{return await P.subtle.verify(f,c,n,o)}catch{return!1}};var en=Xr;async function tn(e,t,n){var o;if(!ee(e))throw new R("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new R('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new R("JWS Protected Header incorrect type");if(e.payload===void 0)throw new R("JWS Payload missing");if(typeof e.signature!="string")throw new R("JWS Signature missing or incorrect type");if(e.header!==void 0&&!ee(e.header))throw new R("JWS Unprotected Header incorrect type");let c={};if(e.protected)try{const W=z(e.protected);c=JSON.parse(ne.decode(W))}catch{throw new R("JWS Protected Header is invalid")}if(!ke(c,e.header))throw new R("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const f={...c,...e.header},g=Qe(R,new Map([["b64",!0]]),n?.crit,c,f);let E=!0;if(g.has("b64")&&(E=c.b64,typeof E!="boolean"))throw new R('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:A}=f;if(typeof A!="string"||!A)throw new R('JWS "alg" (Algorithm) Header Parameter missing or invalid');const m=n&&Je("algorithms",n.algorithms);if(m&&!m.has(A))throw new Ue('"alg" (Algorithm) Header Parameter not allowed');if(E){if(typeof e.payload!="string")throw new R("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new R("JWS Payload must be a string or an Uint8Array instance");let u=!1;typeof t=="function"&&(t=await t(c,e),u=!0),Fe(A,t,"verify");const d=se($.encode((o=e.protected)!==null&&o!==void 0?o:""),$.encode("."),typeof e.payload=="string"?$.encode(e.payload):e.payload),v=z(e.signature);if(!await en(A,t,v,d))throw new sr;let _;E?_=z(e.payload):typeof e.payload=="string"?_=$.encode(e.payload):_=e.payload;const I={payload:_};return e.protected!==void 0&&(I.protectedHeader=c),e.header!==void 0&&(I.unprotectedHeader=e.header),u?{...I,key:t}:I}async function rn(e,t,n){if(e instanceof Uint8Array&&(e=ne.decode(e)),typeof e!="string")throw new R("Compact JWS must be a string or Uint8Array");const{0:o,1:c,2:f,length:g}=e.split(".");if(g!==3)throw new R("Invalid Compact JWS");const E=await tn({payload:c,protected:o,signature:f},t,n),A={payload:E.payload,protectedHeader:E.protectedHeader};return typeof t=="function"?{...A,key:E.key}:A}var be=e=>Math.floor(e.getTime()/1e3);const Wt=60,Ht=Wt*60,Ye=Ht*24,nn=Ye*7,on=Ye*365.25,an=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i;var Me=e=>{const t=an.exec(e);if(!t)throw new TypeError("Invalid time period format");const n=parseFloat(t[1]);switch(t[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(n);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(n*Wt);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(n*Ht);case"day":case"days":case"d":return Math.round(n*Ye);case"week":case"weeks":case"w":return Math.round(n*nn);default:return Math.round(n*on)}};const gt=e=>e.toLowerCase().replace(/^application\//,""),sn=(e,t)=>typeof e=="string"?t.includes(e):Array.isArray(e)?t.some(Set.prototype.has.bind(new Set(e))):!1;var cn=(e,t,n={})=>{const{typ:o}=n;if(o&&(typeof e.typ!="string"||gt(e.typ)!==gt(o)))throw new j('unexpected "typ" JWT header value',"typ","check_failed");let c;try{c=JSON.parse(ne.decode(t))}catch{}if(!ee(c))throw new X("JWT Claims Set must be a top-level JSON object");const{requiredClaims:f=[],issuer:g,subject:E,audience:A,maxTokenAge:m}=n;m!==void 0&&f.push("iat"),A!==void 0&&f.push("aud"),E!==void 0&&f.push("sub"),g!==void 0&&f.push("iss");for(const T of new Set(f.reverse()))if(!(T in c))throw new j(`missing required "${T}" claim`,T,"missing");if(g&&!(Array.isArray(g)?g:[g]).includes(c.iss))throw new j('unexpected "iss" claim value',"iss","check_failed");if(E&&c.sub!==E)throw new j('unexpected "sub" claim value',"sub","check_failed");if(A&&!sn(c.aud,typeof A=="string"?[A]:A))throw new j('unexpected "aud" claim value',"aud","check_failed");let u;switch(typeof n.clockTolerance){case"string":u=Me(n.clockTolerance);break;case"number":u=n.clockTolerance;break;case"undefined":u=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:d}=n,v=be(d||new Date);if((c.iat!==void 0||m)&&typeof c.iat!="number")throw new j('"iat" claim must be a number',"iat","invalid");if(c.nbf!==void 0){if(typeof c.nbf!="number")throw new j('"nbf" claim must be a number',"nbf","invalid");if(c.nbf>v+u)throw new j('"nbf" claim timestamp check failed',"nbf","check_failed")}if(c.exp!==void 0){if(typeof c.exp!="number")throw new j('"exp" claim must be a number',"exp","invalid");if(c.exp<=v-u)throw new pt('"exp" claim timestamp check failed',"exp","check_failed")}if(m){const T=v-c.iat,_=typeof m=="number"?m:Me(m);if(T-u>_)throw new pt('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(T<0-u)throw new j('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return c};async function un(e,t,n){var o;const c=await rn(e,t,n);if(!((o=c.protectedHeader.crit)===null||o===void 0)&&o.includes("b64")&&c.protectedHeader.b64===!1)throw new X("JWTs MUST NOT use unencoded payload");const g={payload:cn(c.protectedHeader,c.payload,n),protectedHeader:c.protectedHeader};return typeof t=="function"?{...g,key:c.key}:g}const ln=async(e,t,n)=>{const o=await Kt(e,t,"sign");Ge(e,o);const c=await P.subtle.sign(Ot(e,o.algorithm),o,n);return new Uint8Array(c)};var pn=ln;class dn{constructor(t){if(!(t instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=t}setProtectedHeader(t){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=t,this}setUnprotectedHeader(t){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=t,this}async sign(t,n){if(!this._protectedHeader&&!this._unprotectedHeader)throw new R("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!ke(this._protectedHeader,this._unprotectedHeader))throw new R("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o={...this._protectedHeader,...this._unprotectedHeader},c=Qe(R,new Map([["b64",!0]]),n?.crit,this._protectedHeader,o);let f=!0;if(c.has("b64")&&(f=this._protectedHeader.b64,typeof f!="boolean"))throw new R('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:g}=o;if(typeof g!="string"||!g)throw new R('JWS "alg" (Algorithm) Header Parameter missing or invalid');Fe(g,t,"sign");let E=this._payload;f&&(E=$.encode(Ae(E)));let A;this._protectedHeader?A=$.encode(Ae(JSON.stringify(this._protectedHeader))):A=$.encode("");const m=se(A,$.encode("."),E),u=await pn(g,t,m),d={signature:Ae(u),payload:""};return f&&(d.payload=ne.decode(E)),this._unprotectedHeader&&(d.header=this._unprotectedHeader),this._protectedHeader&&(d.protected=ne.decode(A)),d}}class fn{constructor(t){this._flattened=new dn(t)}setProtectedHeader(t){return this._flattened.setProtectedHeader(t),this}async sign(t,n){const o=await this._flattened.sign(t,n);if(o.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${o.protected}.${o.payload}.${o.signature}`}}class hn{constructor(t){if(!ee(t))throw new TypeError("JWT Claims Set MUST be an object");this._payload=t}setIssuer(t){return this._payload={...this._payload,iss:t},this}setSubject(t){return this._payload={...this._payload,sub:t},this}setAudience(t){return this._payload={...this._payload,aud:t},this}setJti(t){return this._payload={...this._payload,jti:t},this}setNotBefore(t){return typeof t=="number"?this._payload={...this._payload,nbf:t}:this._payload={...this._payload,nbf:be(new Date)+Me(t)},this}setExpirationTime(t){return typeof t=="number"?this._payload={...this._payload,exp:t}:this._payload={...this._payload,exp:be(new Date)+Me(t)},this}setIssuedAt(t){return typeof t>"u"?this._payload={...this._payload,iat:be(new Date)}:this._payload={...this._payload,iat:t},this}}class yn extends hn{setProtectedHeader(t){return this._protectedHeader=t,this}async sign(t,n){var o;const c=new fn($.encode(JSON.stringify(this._payload)));if(c.setProtectedHeader(this._protectedHeader),Array.isArray((o=this._protectedHeader)===null||o===void 0?void 0:o.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new X("JWTs MUST NOT use unencoded payload");return c.sign(t,n)}}const gn=z;function vn(e){if(typeof e!="string")throw new X("JWTs must use Compact JWS serialization, JWT must be a string");const{1:t,length:n}=e.split(".");if(n===5)throw new X("Only JWTs using Compact JWS serialization can be decoded");if(n!==3)throw new X("Invalid JWT");if(!t)throw new X("JWTs must contain a payload");let o;try{o=gn(t)}catch{throw new X("Failed to parse the base64url encoded payload")}let c;try{c=JSON.parse(ne.decode(o))}catch{throw new X("Failed to parse the decoded payload as JSON")}if(!ee(c))throw new X("Invalid JWT Claims Set");return c}function We(e){var t;const n=(t=e?.modulusLength)!==null&&t!==void 0?t:2048;if(typeof n!="number"||n<2048)throw new K("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return n}async function wn(e,t){var n,o,c,f;let g,E;switch(e){case"PS256":case"PS384":case"PS512":g={name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:We(t)},E=["sign","verify"];break;case"RS256":case"RS384":case"RS512":g={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:We(t)},E=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":g={name:"RSA-OAEP",hash:`SHA-${parseInt(e.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:We(t)},E=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":g={name:"ECDSA",namedCurve:"P-256"},E=["sign","verify"];break;case"ES384":g={name:"ECDSA",namedCurve:"P-384"},E=["sign","verify"];break;case"ES512":g={name:"ECDSA",namedCurve:"P-521"},E=["sign","verify"];break;case"EdDSA":E=["sign","verify"];const A=(n=t?.crv)!==null&&n!==void 0?n:"Ed25519";switch(A){case"Ed25519":case"Ed448":g={name:A};break;default:throw new K("Invalid or unsupported crv option provided")}break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{E=["deriveKey","deriveBits"];const m=(o=t?.crv)!==null&&o!==void 0?o:"P-256";switch(m){case"P-256":case"P-384":case"P-521":{g={name:"ECDH",namedCurve:m};break}case"X25519":case"X448":g={name:m};break;default:throw new K("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new K('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}try{return await P.subtle.generateKey(g,(c=t?.extractable)!==null&&c!==void 0?c:!1,E)}catch(A){if(g.name==="Ed25519"&&A?.name==="NotSupportedError"&&ve())return g={name:"NODE-ED25519",namedCurve:"NODE-ED25519"},await P.subtle.generateKey(g,(f=t?.extractable)!==null&&f!==void 0?f:!1,E);throw A}}async function vt(e,t){return wn(e,t)}var mn="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAxOCAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSI5IiBmaWxsPSIjNEU4NjhFIiAvPgogIDxwYXRoCiAgICBkPSJNMTEuMzQ2MiA1LjIzNDg2QzEwLjg5MjkgNS4yMzc5NSAxMC40NDYzIDUuMzQzOCAxMC4wMzk5IDUuNTQ0NDNDOS42MzM1MiA1Ljc0NTA2IDkuMjc3OTUgNi4wMzUyNiA4Ljk5OTk5IDYuMzkzMTNDOC43MjIyNiA2LjAzNTI4IDguMzY2OTIgNS43NDUxMSA3Ljk2MDcyIDUuNTQ0NDZDNy41NTQ1NSA1LjM0MzgzIDcuMTA4MSA1LjIzNzk3IDYuNjU1MDMgNS4yMzQ4NkM0Ljk2NTEzIDUuMjM0ODYgMy41OTEzNCA2LjY4ODcgMy41OTEzNCA4LjQ3OTAxVjEyLjAyNkMzLjU5MTM0IDEyLjIxNzEgMy42NjczMSAxMi40MDA1IDMuODAyNTYgMTIuNTM1N0MzLjkzNzc5IDEyLjY3MDkgNC4xMjEyMyAxMi43NDY5IDQuMzEyNDkgMTIuNzQ2OUM0LjUwMzc1IDEyLjc0NjkgNC42ODcxNyAxMi42NzA5IDQuODIyNDIgMTIuNTM1N0M0Ljk1NzY4IDEyLjQwMDUgNS4wMzM2NSAxMi4yMTcxIDUuMDMzNjUgMTIuMDI2VjguNDc2NjFDNS4wMzM2NSA3LjQ4MTcyIDUuNzYzMjIgNi42NzQzIDYuNjU5ODUgNi42NzQzQzcuNTU2NDggNi42NzQzIDguMjg2MDYgNy40ODQxNCA4LjI4NjA2IDguNDc2NjFWMTIuMDIzNUM4LjI4NjA2IDEyLjIxNDcgOC4zNjIwMyAxMi4zOTgxIDguNDk3MjYgMTIuNTMzM0M4LjYzMjUyIDEyLjY2ODUgOC44MTU5NSAxMi43NDQ1IDkuMDA3MjIgMTIuNzQ0NUM5LjE5ODQ4IDEyLjc0NDUgOS4zODE4OSAxMi42Njg1IDkuNTE3MTUgMTIuNTMzM0M5LjY1MjM4IDEyLjM5ODEgOS43MjgzNyAxMi4yMTQ3IDkuNzI4MzcgMTIuMDIzNVY4LjQ3NjYxQzkuNzI4MzcgNy40ODE3MiAxMC40NTc5IDYuNjc0MyAxMS4zNTQ2IDYuNjc0M0MxMi4yNTEyIDYuNjc0MyAxMi45ODA4IDcuNDg0MTQgMTIuOTgwOCA4LjQ3NjYxVjEyLjAyMzVDMTIuOTgwOCAxMi4yMTQ3IDEzLjA1NjcgMTIuMzk4MSAxMy4xOTIgMTIuNTMzM0MxMy4zMjcyIDEyLjY2ODUgMTMuNTEwNyAxMi43NDQ1IDEzLjcwMTkgMTIuNzQ0NUMxMy44OTMyIDEyLjc0NDUgMTQuMDc2NiAxMi42Njg1IDE0LjIxMTggMTIuNTMzM0MxNC4zNDcxIDEyLjM5ODEgMTQuNDIzMSAxMi4yMTQ3IDE0LjQyMzEgMTIuMDIzNVY4LjQ3NjYxQzE0LjQwOTggNi42ODg3IDEzLjAzNjEgNS4yMzQ4NiAxMS4zNDYyIDUuMjM0ODZaIgogICAgZmlsbD0id2hpdGUiIC8+Cjwvc3ZnPg==",En=(e=>(e.whileUsingApp="while_using_app",e.untilConnectionDeletion="until_connection_deletion",e))(En||{}),Ce=(e=>(e.invalid_scope="invalid_scope",e.unauthorized_client="unauthorized_client",e.access_denied="access_denied",e.unsupported_response_type="unsupported_response_type",e.server_error="server_error",e.temporarily_unavailable="temporarily_unavailable",e.interaction_required="interaction_required",e.login_required="login_required",e.account_selection_required="account_selection_required",e.consent_required="consent_required",e.invalid_request_uri="invalid_request_uri",e.invalid_request_object="invalid_request_object",e.request_not_supported="request_not_supported",e.request_uri_not_supported="request_uri_not_supported",e.registration_not_supported="registration_not_supported",e.user_cancelled="user_cancelled",e.registration_value_not_supported="registration_value_not_supported",e.subject_syntax_types_not_supported="subject_syntax_types_not_supported",e.invalid_registration_uri="invalid_registration_uri",e.invalid_registration_object="invalid_registration_object",e.validation_failed="validation_failed",e.request_malformed="request_malformed",e.unknown_error="unknown_error",e))(Ce||{});class Y extends Error{constructor(t,n){super(),lt(this,"error"),lt(this,"error_description"),this.error=n||"validation_failed",this.error_description=t}}const Ut=async e=>{const t=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(f=>f.toString(16).padStart(2,"0")).join("")},An=/^did:web:.{1,}:dids:.{1,}/g;function Sn(e){let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()",o=n.length;let c=0;for(;c<e;)t+=n.charAt(Math.floor(Math.random()*o)),c+=1;return t}const bn=e=>{const t=JSON.stringify(e);return window.btoa(t)},_n=e=>{if(e===null)return;const t=window.atob(e);return JSON.parse(t)},Mn=(e,t)=>{const n=e.split("?");if(n.length>=2){const o=`${encodeURIComponent(t)}=`,c=n[1].split(/[&;]/g);for(let f=c.length;f-- >0;)c[f].lastIndexOf(o,0)!==-1&&c.splice(f,1);return n[0]+(c.length>0?`?${c.join("&")}`:"")}return e},Rt=()=>{localStorage.removeItem("meeData")},xt=()=>{try{const e=localStorage.getItem("meeData"),t=_n(e);return typeof t>"u"||typeof t.encrypt>"u"?new Y("Internal error"):new Date(t.exp)<new Date?new Y("Session expired"):t}catch{return new Y("Error getting the Local Storage data")}},Jt=e=>typeof e.error<"u",Cn=()=>{const e="60000",t=()=>{const n=xt();Jt(n)&&n.error_description==="Session expired"&&Rt()};t(),setInterval(()=>{t()},e)},Dn=e=>{try{return JSON.parse(e)}catch{return}};var Lt={exports:{}};(function(e){var t=function(n){var o=1e7,c=7,f=9007199254740992,g=_(f),E="0123456789abcdefghijklmnopqrstuvwxyz",A=typeof BigInt=="function";function m(r,i,a,s){return typeof r>"u"?m[0]:typeof i<"u"?+i==10&&!a?S(r):Yt(r,i,a,s):S(r)}function u(r,i){this.value=r,this.sign=i,this.isSmall=!1}u.prototype=Object.create(m.prototype);function d(r){this.value=r,this.sign=r<0,this.isSmall=!0}d.prototype=Object.create(m.prototype);function v(r){this.value=r}v.prototype=Object.create(m.prototype);function T(r){return-f<r&&r<f}function _(r){return r<1e7?[r]:r<1e14?[r%1e7,Math.floor(r/1e7)]:[r%1e7,Math.floor(r/1e7)%1e7,Math.floor(r/1e14)]}function I(r){W(r);var i=r.length;if(i<4&&ue(r,g)<0)switch(i){case 0:return 0;case 1:return r[0];case 2:return r[0]+r[1]*o;default:return r[0]+(r[1]+r[2]*o)*o}return r}function W(r){for(var i=r.length;r[--i]===0;);r.length=i+1}function U(r){for(var i=new Array(r),a=-1;++a<r;)i[a]=0;return i}function O(r){return r>0?Math.floor(r):Math.ceil(r)}function H(r,i){var a=r.length,s=i.length,p=new Array(a),l=0,h=o,y,w;for(w=0;w<s;w++)y=r[w]+i[w]+l,l=y>=h?1:0,p[w]=y-l*h;for(;w<a;)y=r[w]+l,l=y===h?1:0,p[w++]=y-l*h;return l>0&&p.push(l),p}function J(r,i){return r.length>=i.length?H(r,i):H(i,r)}function B(r,i){var a=r.length,s=new Array(a),p=o,l,h;for(h=0;h<a;h++)l=r[h]-p+i,i=Math.floor(l/p),s[h]=l-i*p,i+=1;for(;i>0;)s[h++]=i%p,i=Math.floor(i/p);return s}u.prototype.add=function(r){var i=S(r);if(this.sign!==i.sign)return this.subtract(i.negate());var a=this.value,s=i.value;return i.isSmall?new u(B(a,Math.abs(s)),this.sign):new u(J(a,s),this.sign)},u.prototype.plus=u.prototype.add,d.prototype.add=function(r){var i=S(r),a=this.value;if(a<0!==i.sign)return this.subtract(i.negate());var s=i.value;if(i.isSmall){if(T(a+s))return new d(a+s);s=_(Math.abs(s))}return new u(B(s,Math.abs(a)),a<0)},d.prototype.plus=d.prototype.add,v.prototype.add=function(r){return new v(this.value+S(r).value)},v.prototype.plus=v.prototype.add;function q(r,i){var a=r.length,s=i.length,p=new Array(a),l=0,h=o,y,w;for(y=0;y<s;y++)w=r[y]-l-i[y],w<0?(w+=h,l=1):l=0,p[y]=w;for(y=s;y<a;y++){if(w=r[y]-l,w<0)w+=h;else{p[y++]=w;break}p[y]=w}for(;y<a;y++)p[y]=r[y];return W(p),p}function F(r,i,a){var s;return ue(r,i)>=0?s=q(r,i):(s=q(i,r),a=!a),s=I(s),typeof s=="number"?(a&&(s=-s),new d(s)):new u(s,a)}function k(r,i,a){var s=r.length,p=new Array(s),l=-i,h=o,y,w;for(y=0;y<s;y++)w=r[y]+l,l=Math.floor(w/h),w%=h,p[y]=w<0?w+h:w;return p=I(p),typeof p=="number"?(a&&(p=-p),new d(p)):new u(p,a)}u.prototype.subtract=function(r){var i=S(r);if(this.sign!==i.sign)return this.add(i.negate());var a=this.value,s=i.value;return i.isSmall?k(a,Math.abs(s),this.sign):F(a,s,this.sign)},u.prototype.minus=u.prototype.subtract,d.prototype.subtract=function(r){var i=S(r),a=this.value;if(a<0!==i.sign)return this.add(i.negate());var s=i.value;return i.isSmall?new d(a-s):k(s,Math.abs(a),a>=0)},d.prototype.minus=d.prototype.subtract,v.prototype.subtract=function(r){return new v(this.value-S(r).value)},v.prototype.minus=v.prototype.subtract,u.prototype.negate=function(){return new u(this.value,!this.sign)},d.prototype.negate=function(){var r=this.sign,i=new d(-this.value);return i.sign=!r,i},v.prototype.negate=function(){return new v(-this.value)},u.prototype.abs=function(){return new u(this.value,!1)},d.prototype.abs=function(){return new d(Math.abs(this.value))},v.prototype.abs=function(){return new v(this.value>=0?this.value:-this.value)};function oe(r,i){var a=r.length,s=i.length,p=a+s,l=U(p),h=o,y,w,b,D,M;for(b=0;b<a;++b){D=r[b];for(var N=0;N<s;++N)M=i[N],y=D*M+l[b+N],w=Math.floor(y/h),l[b+N]=y-w*h,l[b+N+1]+=w}return W(l),l}function he(r,i){var a=r.length,s=new Array(a),p=o,l=0,h,y;for(y=0;y<a;y++)h=r[y]*i+l,l=Math.floor(h/p),s[y]=h-l*p;for(;l>0;)s[y++]=l%p,l=Math.floor(l/p);return s}function je(r,i){for(var a=[];i-- >0;)a.push(0);return a.concat(r)}function we(r,i){var a=Math.max(r.length,i.length);if(a<=30)return oe(r,i);a=Math.ceil(a/2);var s=r.slice(a),p=r.slice(0,a),l=i.slice(a),h=i.slice(0,a),y=we(p,h),w=we(s,l),b=we(J(p,s),J(h,l)),D=J(J(y,je(q(q(b,y),w),a)),je(w,2*a));return W(D),D}function qt(r,i){return-.012*r-.012*i+15e-6*r*i>0}u.prototype.multiply=function(r){var i=S(r),a=this.value,s=i.value,p=this.sign!==i.sign,l;if(i.isSmall){if(s===0)return m[0];if(s===1)return this;if(s===-1)return this.negate();if(l=Math.abs(s),l<o)return new u(he(a,l),p);s=_(l)}return qt(a.length,s.length)?new u(we(a,s),p):new u(oe(a,s),p)},u.prototype.times=u.prototype.multiply;function Xe(r,i,a){return r<o?new u(he(i,r),a):new u(oe(i,_(r)),a)}d.prototype._multiplyBySmall=function(r){return T(r.value*this.value)?new d(r.value*this.value):Xe(Math.abs(r.value),_(Math.abs(this.value)),this.sign!==r.sign)},u.prototype._multiplyBySmall=function(r){return r.value===0?m[0]:r.value===1?this:r.value===-1?this.negate():Xe(Math.abs(r.value),this.value,this.sign!==r.sign)},d.prototype.multiply=function(r){return S(r)._multiplyBySmall(this)},d.prototype.times=d.prototype.multiply,v.prototype.multiply=function(r){return new v(this.value*S(r).value)},v.prototype.times=v.prototype.multiply;function et(r){var i=r.length,a=U(i+i),s=o,p,l,h,y,w;for(h=0;h<i;h++){y=r[h],l=0-y*y;for(var b=h;b<i;b++)w=r[b],p=2*(y*w)+a[h+b]+l,l=Math.floor(p/s),a[h+b]=p-l*s;a[h+i]=l}return W(a),a}u.prototype.square=function(){return new u(et(this.value),!1)},d.prototype.square=function(){var r=this.value*this.value;return T(r)?new d(r):new u(et(_(Math.abs(this.value))),!1)},v.prototype.square=function(r){return new v(this.value*this.value)};function kt(r,i){var a=r.length,s=i.length,p=o,l=U(i.length),h=i[s-1],y=Math.ceil(p/(2*h)),w=he(r,y),b=he(i,y),D,M,N,Q,G,Te,Oe;for(w.length<=a&&w.push(0),b.push(0),h=b[s-1],M=a-s;M>=0;M--){for(D=p-1,w[M+s]!==h&&(D=Math.floor((w[M+s]*p+w[M+s-1])/h)),N=0,Q=0,Te=b.length,G=0;G<Te;G++)N+=D*b[G],Oe=Math.floor(N/p),Q+=w[M+G]-(N-Oe*p),N=Oe,Q<0?(w[M+G]=Q+p,Q=-1):(w[M+G]=Q,Q=0);for(;Q!==0;){for(D-=1,N=0,G=0;G<Te;G++)N+=w[M+G]-p+b[G],N<0?(w[M+G]=N+p,N=0):(w[M+G]=N,N=1);Q+=N}l[M]=D}return w=tt(w,y)[0],[I(l),I(w)]}function Gt(r,i){for(var a=r.length,s=i.length,p=[],l=[],h=o,y,w,b,D,M;a;){if(l.unshift(r[--a]),W(l),ue(l,i)<0){p.push(0);continue}w=l.length,b=l[w-1]*h+l[w-2],D=i[s-1]*h+i[s-2],w>s&&(b=(b+1)*h),y=Math.ceil(b/D);do{if(M=he(i,y),ue(M,l)<=0)break;y--}while(y);p.push(y),l=q(l,M)}return p.reverse(),[I(p),I(l)]}function tt(r,i){var a=r.length,s=U(a),p=o,l,h,y,w;for(y=0,l=a-1;l>=0;--l)w=y*p+r[l],h=O(w/i),y=w-h*i,s[l]=h|0;return[s,y|0]}function ce(r,i){var a,s=S(i);if(A)return[new v(r.value/s.value),new v(r.value%s.value)];var p=r.value,l=s.value,h;if(l===0)throw new Error("Cannot divide by zero");if(r.isSmall)return s.isSmall?[new d(O(p/l)),new d(p%l)]:[m[0],r];if(s.isSmall){if(l===1)return[r,m[0]];if(l==-1)return[r.negate(),m[0]];var y=Math.abs(l);if(y<o){a=tt(p,y),h=I(a[0]);var w=a[1];return r.sign&&(w=-w),typeof h=="number"?(r.sign!==s.sign&&(h=-h),[new d(h),new d(w)]):[new u(h,r.sign!==s.sign),new d(w)]}l=_(y)}var b=ue(p,l);if(b===-1)return[m[0],r];if(b===0)return[m[r.sign===s.sign?1:-1],m[0]];p.length+l.length<=200?a=kt(p,l):a=Gt(p,l),h=a[0];var D=r.sign!==s.sign,M=a[1],N=r.sign;return typeof h=="number"?(D&&(h=-h),h=new d(h)):h=new u(h,D),typeof M=="number"?(N&&(M=-M),M=new d(M)):M=new u(M,N),[h,M]}u.prototype.divmod=function(r){var i=ce(this,r);return{quotient:i[0],remainder:i[1]}},v.prototype.divmod=d.prototype.divmod=u.prototype.divmod,u.prototype.divide=function(r){return ce(this,r)[0]},v.prototype.over=v.prototype.divide=function(r){return new v(this.value/S(r).value)},d.prototype.over=d.prototype.divide=u.prototype.over=u.prototype.divide,u.prototype.mod=function(r){return ce(this,r)[1]},v.prototype.mod=v.prototype.remainder=function(r){return new v(this.value%S(r).value)},d.prototype.remainder=d.prototype.mod=u.prototype.remainder=u.prototype.mod,u.prototype.pow=function(r){var i=S(r),a=this.value,s=i.value,p,l,h;if(s===0)return m[1];if(a===0)return m[0];if(a===1)return m[1];if(a===-1)return i.isEven()?m[1]:m[-1];if(i.sign)return m[0];if(!i.isSmall)throw new Error("The exponent "+i.toString()+" is too large.");if(this.isSmall&&T(p=Math.pow(a,s)))return new d(O(p));for(l=this,h=m[1];s&!0&&(h=h.times(l),--s),s!==0;)s/=2,l=l.square();return h},d.prototype.pow=u.prototype.pow,v.prototype.pow=function(r){var i=S(r),a=this.value,s=i.value,p=BigInt(0),l=BigInt(1),h=BigInt(2);if(s===p)return m[1];if(a===p)return m[0];if(a===l)return m[1];if(a===BigInt(-1))return i.isEven()?m[1]:m[-1];if(i.isNegative())return new v(p);for(var y=this,w=m[1];(s&l)===l&&(w=w.times(y),--s),s!==p;)s/=h,y=y.square();return w},u.prototype.modPow=function(r,i){if(r=S(r),i=S(i),i.isZero())throw new Error("Cannot take modPow with modulus 0");var a=m[1],s=this.mod(i);for(r.isNegative()&&(r=r.multiply(m[-1]),s=s.modInv(i));r.isPositive();){if(s.isZero())return m[0];r.isOdd()&&(a=a.multiply(s).mod(i)),r=r.divide(2),s=s.square().mod(i)}return a},v.prototype.modPow=d.prototype.modPow=u.prototype.modPow;function ue(r,i){if(r.length!==i.length)return r.length>i.length?1:-1;for(var a=r.length-1;a>=0;a--)if(r[a]!==i[a])return r[a]>i[a]?1:-1;return 0}u.prototype.compareAbs=function(r){var i=S(r),a=this.value,s=i.value;return i.isSmall?1:ue(a,s)},d.prototype.compareAbs=function(r){var i=S(r),a=Math.abs(this.value),s=i.value;return i.isSmall?(s=Math.abs(s),a===s?0:a>s?1:-1):-1},v.prototype.compareAbs=function(r){var i=this.value,a=S(r).value;return i=i>=0?i:-i,a=a>=0?a:-a,i===a?0:i>a?1:-1},u.prototype.compare=function(r){if(r===1/0)return-1;if(r===-1/0)return 1;var i=S(r),a=this.value,s=i.value;return this.sign!==i.sign?i.sign?1:-1:i.isSmall?this.sign?-1:1:ue(a,s)*(this.sign?-1:1)},u.prototype.compareTo=u.prototype.compare,d.prototype.compare=function(r){if(r===1/0)return-1;if(r===-1/0)return 1;var i=S(r),a=this.value,s=i.value;return i.isSmall?a==s?0:a>s?1:-1:a<0!==i.sign?a<0?-1:1:a<0?1:-1},d.prototype.compareTo=d.prototype.compare,v.prototype.compare=function(r){if(r===1/0)return-1;if(r===-1/0)return 1;var i=this.value,a=S(r).value;return i===a?0:i>a?1:-1},v.prototype.compareTo=v.prototype.compare,u.prototype.equals=function(r){return this.compare(r)===0},v.prototype.eq=v.prototype.equals=d.prototype.eq=d.prototype.equals=u.prototype.eq=u.prototype.equals,u.prototype.notEquals=function(r){return this.compare(r)!==0},v.prototype.neq=v.prototype.notEquals=d.prototype.neq=d.prototype.notEquals=u.prototype.neq=u.prototype.notEquals,u.prototype.greater=function(r){return this.compare(r)>0},v.prototype.gt=v.prototype.greater=d.prototype.gt=d.prototype.greater=u.prototype.gt=u.prototype.greater,u.prototype.lesser=function(r){return this.compare(r)<0},v.prototype.lt=v.prototype.lesser=d.prototype.lt=d.prototype.lesser=u.prototype.lt=u.prototype.lesser,u.prototype.greaterOrEquals=function(r){return this.compare(r)>=0},v.prototype.geq=v.prototype.greaterOrEquals=d.prototype.geq=d.prototype.greaterOrEquals=u.prototype.geq=u.prototype.greaterOrEquals,u.prototype.lesserOrEquals=function(r){return this.compare(r)<=0},v.prototype.leq=v.prototype.lesserOrEquals=d.prototype.leq=d.prototype.lesserOrEquals=u.prototype.leq=u.prototype.lesserOrEquals,u.prototype.isEven=function(){return(this.value[0]&1)===0},d.prototype.isEven=function(){return(this.value&1)===0},v.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},u.prototype.isOdd=function(){return(this.value[0]&1)===1},d.prototype.isOdd=function(){return(this.value&1)===1},v.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},u.prototype.isPositive=function(){return!this.sign},d.prototype.isPositive=function(){return this.value>0},v.prototype.isPositive=d.prototype.isPositive,u.prototype.isNegative=function(){return this.sign},d.prototype.isNegative=function(){return this.value<0},v.prototype.isNegative=d.prototype.isNegative,u.prototype.isUnit=function(){return!1},d.prototype.isUnit=function(){return Math.abs(this.value)===1},v.prototype.isUnit=function(){return this.abs().value===BigInt(1)},u.prototype.isZero=function(){return!1},d.prototype.isZero=function(){return this.value===0},v.prototype.isZero=function(){return this.value===BigInt(0)},u.prototype.isDivisibleBy=function(r){var i=S(r);return i.isZero()?!1:i.isUnit()?!0:i.compareAbs(2)===0?this.isEven():this.mod(i).isZero()},v.prototype.isDivisibleBy=d.prototype.isDivisibleBy=u.prototype.isDivisibleBy;function rt(r){var i=r.abs();if(i.isUnit())return!1;if(i.equals(2)||i.equals(3)||i.equals(5))return!0;if(i.isEven()||i.isDivisibleBy(3)||i.isDivisibleBy(5))return!1;if(i.lesser(49))return!0}function De(r,i){for(var a=r.prev(),s=a,p=0,l,h,y;s.isEven();)s=s.divide(2),p++;e:for(h=0;h<i.length;h++)if(!r.lesser(i[h])&&(y=t(i[h]).modPow(s,r),!(y.isUnit()||y.equals(a)))){for(l=p-1;l!=0;l--){if(y=y.square().mod(r),y.isUnit())return!1;if(y.equals(a))continue e}return!1}return!0}u.prototype.isPrime=function(r){var i=rt(this);if(i!==n)return i;var a=this.abs(),s=a.bitLength();if(s<=64)return De(a,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var p=Math.log(2)*s.toJSNumber(),l=Math.ceil(r===!0?2*Math.pow(p,2):p),h=[],y=0;y<l;y++)h.push(t(y+2));return De(a,h)},v.prototype.isPrime=d.prototype.isPrime=u.prototype.isPrime,u.prototype.isProbablePrime=function(r,i){var a=rt(this);if(a!==n)return a;for(var s=this.abs(),p=r===n?5:r,l=[],h=0;h<p;h++)l.push(t.randBetween(2,s.minus(2),i));return De(s,l)},v.prototype.isProbablePrime=d.prototype.isProbablePrime=u.prototype.isProbablePrime,u.prototype.modInv=function(r){for(var i=t.zero,a=t.one,s=S(r),p=this.abs(),l,h,y;!p.isZero();)l=s.divide(p),h=i,y=s,i=a,s=p,a=h.subtract(l.multiply(a)),p=y.subtract(l.multiply(p));if(!s.isUnit())throw new Error(this.toString()+" and "+r.toString()+" are not co-prime");return i.compare(0)===-1&&(i=i.add(r)),this.isNegative()?i.negate():i},v.prototype.modInv=d.prototype.modInv=u.prototype.modInv,u.prototype.next=function(){var r=this.value;return this.sign?k(r,1,this.sign):new u(B(r,1),this.sign)},d.prototype.next=function(){var r=this.value;return r+1<f?new d(r+1):new u(g,!1)},v.prototype.next=function(){return new v(this.value+BigInt(1))},u.prototype.prev=function(){var r=this.value;return this.sign?new u(B(r,1),!0):k(r,1,this.sign)},d.prototype.prev=function(){var r=this.value;return r-1>-f?new d(r-1):new u(g,!0)},v.prototype.prev=function(){return new v(this.value-BigInt(1))};for(var te=[1];2*te[te.length-1]<=o;)te.push(2*te[te.length-1]);var ye=te.length,le=te[ye-1];function nt(r){return Math.abs(r)<=o}u.prototype.shiftLeft=function(r){var i=S(r).toJSNumber();if(!nt(i))throw new Error(String(i)+" is too large for shifting.");if(i<0)return this.shiftRight(-i);var a=this;if(a.isZero())return a;for(;i>=ye;)a=a.multiply(le),i-=ye-1;return a.multiply(te[i])},v.prototype.shiftLeft=d.prototype.shiftLeft=u.prototype.shiftLeft,u.prototype.shiftRight=function(r){var i,a=S(r).toJSNumber();if(!nt(a))throw new Error(String(a)+" is too large for shifting.");if(a<0)return this.shiftLeft(-a);for(var s=this;a>=ye;){if(s.isZero()||s.isNegative()&&s.isUnit())return s;i=ce(s,le),s=i[1].isNegative()?i[0].prev():i[0],a-=ye-1}return i=ce(s,te[a]),i[1].isNegative()?i[0].prev():i[0]},v.prototype.shiftRight=d.prototype.shiftRight=u.prototype.shiftRight;function Ie(r,i,a){i=S(i);for(var s=r.isNegative(),p=i.isNegative(),l=s?r.not():r,h=p?i.not():i,y=0,w=0,b=null,D=null,M=[];!l.isZero()||!h.isZero();)b=ce(l,le),y=b[1].toJSNumber(),s&&(y=le-1-y),D=ce(h,le),w=D[1].toJSNumber(),p&&(w=le-1-w),l=b[0],h=D[0],M.push(a(y,w));for(var N=a(s?1:0,p?1:0)!==0?t(-1):t(0),Q=M.length-1;Q>=0;Q-=1)N=N.multiply(le).add(t(M[Q]));return N}u.prototype.not=function(){return this.negate().prev()},v.prototype.not=d.prototype.not=u.prototype.not,u.prototype.and=function(r){return Ie(this,r,function(i,a){return i&a})},v.prototype.and=d.prototype.and=u.prototype.and,u.prototype.or=function(r){return Ie(this,r,function(i,a){return i|a})},v.prototype.or=d.prototype.or=u.prototype.or,u.prototype.xor=function(r){return Ie(this,r,function(i,a){return i^a})},v.prototype.xor=d.prototype.xor=u.prototype.xor;var Pe=1<<30,Ft=(o&-o)*(o&-o)|Pe;function me(r){var i=r.value,a=typeof i=="number"?i|Pe:typeof i=="bigint"?i|BigInt(Pe):i[0]+i[1]*o|Ft;return a&-a}function it(r,i){if(i.compareTo(r)<=0){var a=it(r,i.square(i)),s=a.p,p=a.e,l=s.multiply(i);return l.compareTo(r)<=0?{p:l,e:p*2+1}:{p:s,e:p*2}}return{p:t(1),e:0}}u.prototype.bitLength=function(){var r=this;return r.compareTo(t(0))<0&&(r=r.negate().subtract(t(1))),r.compareTo(t(0))===0?t(0):t(it(r,t(2)).e).add(t(1))},v.prototype.bitLength=d.prototype.bitLength=u.prototype.bitLength;function ot(r,i){return r=S(r),i=S(i),r.greater(i)?r:i}function Ne(r,i){return r=S(r),i=S(i),r.lesser(i)?r:i}function at(r,i){if(r=S(r).abs(),i=S(i).abs(),r.equals(i))return r;if(r.isZero())return i;if(i.isZero())return r;for(var a=m[1],s,p;r.isEven()&&i.isEven();)s=Ne(me(r),me(i)),r=r.divide(s),i=i.divide(s),a=a.multiply(s);for(;r.isEven();)r=r.divide(me(r));do{for(;i.isEven();)i=i.divide(me(i));r.greater(i)&&(p=i,i=r,r=p),i=i.subtract(r)}while(!i.isZero());return a.isUnit()?r:r.multiply(a)}function Qt(r,i){return r=S(r).abs(),i=S(i).abs(),r.divide(at(r,i)).multiply(i)}function Vt(r,i,a){r=S(r),i=S(i);var s=a||Math.random,p=Ne(r,i),l=ot(r,i),h=l.subtract(p).add(1);if(h.isSmall)return p.add(Math.floor(s()*h));for(var y=ge(h,o).value,w=[],b=!0,D=0;D<y.length;D++){var M=b?y[D]+(D+1<y.length?y[D+1]/o:0):o,N=O(s()*M);w.push(N),N<y[D]&&(b=!1)}return p.add(m.fromArray(w,o,!1))}var Yt=function(r,i,a,s){a=a||E,r=String(r),s||(r=r.toLowerCase(),a=a.toLowerCase());var p=r.length,l,h=Math.abs(i),y={};for(l=0;l<a.length;l++)y[a[l]]=l;for(l=0;l<p;l++){var w=r[l];if(w!=="-"&&w in y&&y[w]>=h){if(w==="1"&&h===1)continue;throw new Error(w+" is not a valid digit in base "+i+".")}}i=S(i);var b=[],D=r[0]==="-";for(l=D?1:0;l<r.length;l++){var w=r[l];if(w in y)b.push(S(y[w]));else if(w==="<"){var M=l;do l++;while(r[l]!==">"&&l<r.length);b.push(S(r.slice(M+1,l)))}else throw new Error(w+" is not a valid character")}return st(b,i,D)};function st(r,i,a){var s=m[0],p=m[1],l;for(l=r.length-1;l>=0;l--)s=s.add(r[l].times(p)),p=p.times(i);return a?s.negate():s}function Zt(r,i){return i=i||E,r<i.length?i[r]:"<"+r+">"}function ge(r,i){if(i=t(i),i.isZero()){if(r.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(i.equals(-1)){if(r.isZero())return{value:[0],isNegative:!1};if(r.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-r.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var a=Array.apply(null,Array(r.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return a.unshift([1]),{value:[].concat.apply([],a),isNegative:!1}}var s=!1;if(r.isNegative()&&i.isPositive()&&(s=!0,r=r.abs()),i.isUnit())return r.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(r.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:s};for(var p=[],l=r,h;l.isNegative()||l.compareAbs(i)>=0;){h=l.divmod(i),l=h.quotient;var y=h.remainder;y.isNegative()&&(y=i.minus(y).abs(),l=l.next()),p.push(y.toJSNumber())}return p.push(l.toJSNumber()),{value:p.reverse(),isNegative:s}}function ct(r,i,a){var s=ge(r,i);return(s.isNegative?"-":"")+s.value.map(function(p){return Zt(p,a)}).join("")}u.prototype.toArray=function(r){return ge(this,r)},d.prototype.toArray=function(r){return ge(this,r)},v.prototype.toArray=function(r){return ge(this,r)},u.prototype.toString=function(r,i){if(r===n&&(r=10),r!==10)return ct(this,r,i);for(var a=this.value,s=a.length,p=String(a[--s]),l="0000000",h;--s>=0;)h=String(a[s]),p+=l.slice(h.length)+h;var y=this.sign?"-":"";return y+p},d.prototype.toString=function(r,i){return r===n&&(r=10),r!=10?ct(this,r,i):String(this.value)},v.prototype.toString=d.prototype.toString,v.prototype.toJSON=u.prototype.toJSON=d.prototype.toJSON=function(){return this.toString()},u.prototype.valueOf=function(){return parseInt(this.toString(),10)},u.prototype.toJSNumber=u.prototype.valueOf,d.prototype.valueOf=function(){return this.value},d.prototype.toJSNumber=d.prototype.valueOf,v.prototype.valueOf=v.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};function ut(r){if(T(+r)){var i=+r;if(i===O(i))return A?new v(BigInt(i)):new d(i);throw new Error("Invalid integer: "+r)}var a=r[0]==="-";a&&(r=r.slice(1));var s=r.split(/e/i);if(s.length>2)throw new Error("Invalid integer: "+s.join("e"));if(s.length===2){var p=s[1];if(p[0]==="+"&&(p=p.slice(1)),p=+p,p!==O(p)||!T(p))throw new Error("Invalid integer: "+p+" is not a valid exponent.");var l=s[0],h=l.indexOf(".");if(h>=0&&(p-=l.length-h-1,l=l.slice(0,h)+l.slice(h+1)),p<0)throw new Error("Cannot include negative exponent part for integers");l+=new Array(p+1).join("0"),r=l}var y=/^([0-9][0-9]*)$/.test(r);if(!y)throw new Error("Invalid integer: "+r);if(A)return new v(BigInt(a?"-"+r:r));for(var w=[],b=r.length,D=c,M=b-D;b>0;)w.push(+r.slice(M,b)),M-=D,M<0&&(M=0),b-=D;return W(w),new u(w,a)}function jt(r){if(A)return new v(BigInt(r));if(T(r)){if(r!==O(r))throw new Error(r+" is not an integer.");return new d(r)}return ut(r.toString())}function S(r){return typeof r=="number"?jt(r):typeof r=="string"?ut(r):typeof r=="bigint"?new v(r):r}for(var pe=0;pe<1e3;pe++)m[pe]=S(pe),pe>0&&(m[-pe]=S(-pe));return m.one=m[1],m.zero=m[0],m.minusOne=m[-1],m.max=ot,m.min=Ne,m.gcd=at,m.lcm=Qt,m.isInstance=function(r){return r instanceof u||r instanceof d||r instanceof v},m.randBetween=Vt,m.fromArray=function(r,i,a){return st(r.map(S),S(i||10),a)},m}();e.hasOwnProperty("exports")&&(e.exports=t)})(Lt);var Ze=Lt.exports;function In(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),o=0;o<n.length;o++)n[o]=255;for(var c=0;c<e.length;c++){var f=e.charAt(c),g=f.charCodeAt(0);if(n[g]!==255)throw new TypeError(f+" is ambiguous");n[g]=c}var E=e.length,A=e.charAt(0),m=Math.log(E)/Math.log(256),u=Math.log(256)/Math.log(E);function d(_){if(_ instanceof Uint8Array||(ArrayBuffer.isView(_)?_=new Uint8Array(_.buffer,_.byteOffset,_.byteLength):Array.isArray(_)&&(_=Uint8Array.from(_))),!(_ instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(_.length===0)return"";for(var I=0,W=0,U=0,O=_.length;U!==O&&_[U]===0;)U++,I++;for(var H=(O-U)*u+1>>>0,J=new Uint8Array(H);U!==O;){for(var B=_[U],q=0,F=H-1;(B!==0||q<W)&&F!==-1;F--,q++)B+=256*J[F]>>>0,J[F]=B%E>>>0,B=B/E>>>0;if(B!==0)throw new Error("Non-zero carry");W=q,U++}for(var k=H-W;k!==H&&J[k]===0;)k++;for(var oe=A.repeat(I);k<H;++k)oe+=e.charAt(J[k]);return oe}function v(_){if(typeof _!="string")throw new TypeError("Expected String");if(_.length===0)return new Uint8Array;var I=0;if(_[I]!==" "){for(var W=0,U=0;_[I]===A;)W++,I++;for(var O=(_.length-I)*m+1>>>0,H=new Uint8Array(O);_[I];){var J=n[_.charCodeAt(I)];if(J===255)return;for(var B=0,q=O-1;(J!==0||B<U)&&q!==-1;q--,B++)J+=E*H[q]>>>0,H[q]=J%256>>>0,J=J/256>>>0;if(J!==0)throw new Error("Non-zero carry");U=B,I++}if(_[I]!==" "){for(var F=O-U;F!==O&&H[F]===0;)F++;for(var k=new Uint8Array(W+(O-F)),oe=W;F!==O;)k[oe++]=H[F++];return k}}}function T(_){var I=v(_);if(I)return I;throw new Error(`Non-${t} character`)}return{encode:d,decodeUnsafe:v,decode:T}}var Pn=In,Nn=Pn;const Tn=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class On{constructor(t,n,o){this.name=t,this.prefix=n,this.baseEncode=o}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Kn{constructor(t,n,o){if(this.name=t,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=o}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return zt(this,t)}}class Wn{constructor(t){this.decoders=t}or(t){return zt(this,t)}decode(t){const n=t[0],o=this.decoders[n];if(o)return o.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const zt=(e,t)=>new Wn({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Hn{constructor(t,n,o,c){this.name=t,this.prefix=n,this.baseEncode=o,this.baseDecode=c,this.encoder=new On(t,n,o),this.decoder=new Kn(t,n,c)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Un=({name:e,prefix:t,encode:n,decode:o})=>new Hn(e,t,n,o),Bt=({prefix:e,name:t,alphabet:n})=>{const{encode:o,decode:c}=Nn(n,t);return Un({prefix:e,name:t,encode:o,decode:f=>Tn(c(f))})},Rn=Bt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});Bt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const wt=[128,36],Ee=Ze(2),Le=Ee.pow(256).subtract(Ee.pow(224)).add(Ee.pow(192)).add(Ee.pow(96)).subtract(1),xn=Ze("41058363725152142129326129780047268409114441015993725554835256314039467401291"),Jn=Le.add(1).divide(4);function mt(e,t){let n=`${e}`;for(;n.length<t;)n=`0${n}`;return n}function Ln(e){return[...new Uint8Array(e)].map(t=>t.toString(16).padStart(2,"0")).join("")}const zn=e=>{var t;const n=(t=e.match(/.{1,2}/g))==null?void 0:t.map(c=>parseInt(c,16));if(typeof n>"u")throw new Error("Hex string invalid");return Uint8Array.from(n)};function Bn(e){const t=Number(e[1])-2,n=Ze(e.substring(2),16);let o=n.pow(3).subtract(n.multiply(3)).add(xn).modPow(Jn,Le);return o.mod(2).toJSNumber()!==t&&(o=Le.subtract(o)),`04${mt(n.toString(16),64)}${mt(o.toString(16),64)}`}const $n=async e=>{try{if(typeof e.sub>"u")return null;const t=e.sub;if(!t.startsWith("did:key"))return null;const n=t.split(":")[2],o=Rn.decode(n);if(o[0]===wt[0]&&o[1]===wt[1]){const c=o.slice(2,o.length);if(c.length===33||c.length===64||c.length===65){const f=Bn(Ln(c)),g=await crypto.subtle.importKey("raw",zn(f),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"]);return await Ve(g)}}return null}catch(t){return console.log(t),null}},qn=async e=>{var t;try{if(typeof e.sub>"u"||!An.test(e.sub))return null;const n=(t=e.sub)==null?void 0:t.split("did:web:");if(typeof n>"u"||n.length!==2)return null;const c=`https://${n[1].replaceAll(":","/")}/did.json`,f=await fetch(c).then(E=>E.json()),g=f.verificationMethod.find(E=>E.type==="JsonWebKey2020");return typeof g>"u"||f.id!==e.sub?null:g.publicKeyJwk}catch{return null}};function kn(e){const{aud:t,exp:n,iat:o,jti:c,nbf:f,sub:g,nonce:E,...A}=e,m=A,u={...m};return Object.keys(m).forEach(d=>{const v=Dn(m[d]);typeof v<"u"&&(u[d]=v)}),u}const Gn=async e=>{var t,n;switch(!0){case((t=e.sub)==null?void 0:t.startsWith("did:web")):return qn(e);case((n=e.sub)==null?void 0:n.startsWith("did:key")):return $n(e);default:return null}};async function Fn(e,t){try{const n=xt();if(Rt(),Jt(n))return{error:n};const o=await zr(n.encrypt,"RSA-OAEP"),c=await Vr(e,o),f=new TextDecoder().decode(c.plaintext),g=vn(f),E=await Gn(g);if(E===null)return{error:new Y("Can not get jwk from payload")};const A=await Tt(E,"ES256"),m=await un(f,A,{audience:t}),{payload:u}=m;return typeof u.error<"u"?{error:new Y(u.error)}:u.iss!==u.sub?{error:new Y("iss should be equal to sub")}:typeof n>"u"||n?.nonce===null?{error:new Y("No nonce found")}:await Ut(n.nonce)!==u.nonce?{error:new Y("Nonce is not valid")}:{data:kn(u)}}catch(n){return{error:new Y(n)}}}async function Qn(e,t,n,o){if(t===null||typeof t.redirect_uri>"u")throw new Y("Please provide valid redirect url",Ce.request_malformed);return await new yn({...e}).setProtectedHeader({alg:"ES256",jwk:o}).setIssuedAt().setAudience(t?.redirect_uri).sign(n)}const Vn=async()=>{const e=await vt("ES256",{extractable:!0}),t=await vt("RSA-OAEP",{extractable:!0});return{sign:e,encrypt:t}},Yn=async e=>await Ve(e),Et=async e=>await jr(e),At="https://auth.mee.foundation/",Zn="authorize";let de=null,ze=null,Be=null;const $e=Sn(50),jn=e=>{const o=window.location.search.substring(1).split("&").find(c=>c.split("=")[0]===e);return o?.split("=")[1]},$t=()=>{try{const e="2";if($e!==null&&Be!==null){const t=Date.now()+36e5*e,n=bn({nonce:$e,...Be,exp:t});localStorage.setItem("meeData",n)}}finally{de!==null&&ze!==null&&window.open(de.client_id?`${At}${Zn}?scope=openid&request=${ze}`:`${At}app`,"_blank")}},Xn="#111827",ei=async e=>{const t=document.getElementById(e),n=document.createElement("button"),o=document.createElement("img");o.src=mn,o.alt="Mee",o.style.width="18px",o.style.height="18px";const c=document.createElement("p");o.className="meeLogo",c.className="meeText",n.className="meeButton",c.innerHTML="Connect with Mee",c.style.fontWeight="700",c.style.margin="0px",c.style.fontSize="14px",c.style.color=Xn,n.style.display="flex",n.style.flexDirection="row",n.style.alignItems="center",n.style.justifyContent="center",n.style.width="100%",n.style.gap="8px",n.style.paddingLeft="8px",n.style.paddingRight="16px",n.style.borderRadius="3px",n.style.border="0px solid #808080",n.style.backgroundColor="#FFF",n.style.paddingTop="9px",n.style.paddingBottom="9px",n.addEventListener("mouseover",()=>{n.style.boxShadow="0px 4px 6px -2px #0000000D, 0px 10px 15px -3px #0000001A"}),n.addEventListener("mouseleave",()=>{n.style.boxShadow=""}),n.addEventListener("click",()=>$t()),n.appendChild(o),n.appendChild(c),t?.appendChild(n)},St=()=>{window.history.replaceState({},document.title,Mn(window.location.href,"id_token"))},ti=async(e,t)=>{Cn(),typeof e.container_id<"u"&&ei(e.container_id);const n=await Vn(),o=await Yn(n.encrypt.publicKey),{container_id:c,...f}=e;de={...f,client_id:e.redirect_uri,client_metadata:{...e.client_metadata,subject_syntax_types_supported:["did:key"],application_type:"web",jwks:[{...o,alg:"RSA-OAEP",key_ops:["encrypt","wrapKey"]}]},scope:"openid",response_type:"id_token",nonce:await Ut($e)};const g=await Ve(n.sign.publicKey);ze=await Qn(de,de,n.sign.privateKey,g);const E=await Et(n.sign.privateKey);Be={encrypt:await Et(n.encrypt.privateKey),sign:E};const m=jn("id_token");if(typeof m<"u")if(m.startsWith("error:")){const u=m.split(",error_description:"),d=u.length===2?u[1].replace(/%20/g," "):"",v=u[0].split("error:"),T=v.length===2?v[1]:"",_=T in Ce,I=new Y(d,_?T:Ce.unknown_error);St(),t({error:I,data:void 0})}else St(),Fn(m,de.client_id).then(u=>t(u))},ri=()=>{$t()},ni=(e,t)=>{ti(e,t)};export{En as M,ri as a,ni as i};
